
<script src="lib/jquery.cookie/jquery.cookie.js" type="text/javascript"></script>

<link href="lib/fancytree/dist/skin-lion/ui.fancytree.min.css" rel="stylesheet">
<script src="lib/fancytree/dist/jquery.fancytree-all-deps.min.js"></script>


<style type="text/css">
   .td-progress {
      margin-right: 5px;
      position: relative;
      top: 2px;
   }
   .td-mgrEffortEstim, .td-effortEstim, .td-reestimated, .td-elapsed, .td-backlog, .td-mgrDrift, .td-drift {
      border: solid #CCCCCC 1px;
      border-bottom: none;
      padding: 0em 0.5em;
      width: 100px;
      float: left;
   }


</style>


<div id="content">
   <a id="bt_loadTree" style="text-decoration: none" href="{$page}">
      <img align="absmiddle" src="images/b_refresh.png" style="vertical-align: middle;" > {t}Reload{/t}</a>

   <div id="testFancytree">
      <h2>test Fancytree lib</h2>

      <table id="treegrid">
         <colgroup>
            <col width="400px">
            <col width="120px">
            <col width="100px">
            <col width="100px">
            <col width="100px">
            <col width="100px">
         </colgroup>
         <thead>
            <tr>
               <td></td>
               <th>Progress</th>
               <th>EE</th>
               <th>Reestimated</th>
               <th>Elapsed</th>
               <th>Backlog</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <td></td>
               <td><div class='td-progress progress'></div></td>
               <td><span class='td-effortEstim'>&nbsp;</span></td>
               <td><span class='td-reestimated'>&nbsp;</span></td>
               <td><span class='td-elapsed'>&nbsp;</span></td>
               <td><span class='td-backlog'>&nbsp;</span></td>
            </tr>
         </tbody>
      </table>
   </div>
</div>

<script type="text/javascript">
   jQuery(document).ready(function() {
       jQuery("#bt_loadTree").click(function(event) {
          event.preventDefault();
          $("#tree").dynatree("destroy");
          initTree();
       });
   });

   function initTree() {
      // --- Fancytree widget --------------------------------------------

      $( "#treegrid" ).fancytree({
         treeId: "1",
         extensions: [ "table" ],
         generateIds: true,
         table: {
            nodeColumnIdx: 0       // render the node title into the 2nd column
         },
         source: {
            url: 'include/fancytree_ajax.php',
    		   type: "POST",
            cache: false,
            data: { wbsRootId: "{$wbsRootId}",
                    hasDetail: "1",
                    action: "loadWBS"
            }
         },
         renderColumns: function( event, data ) {
            var node = data.node;
            //var $tdList = $( node.tr ).find( ">td" );
            //$tdList.eq( 1 ).find("div").text( node.data.progress );

            $( node.tr ).find( ".td-effortEstim" ).text( node.data.effortEstim );
            $( node.tr ).find( ".td-reestimated" ).text( node.data.reestimated );
            $( node.tr ).find( ".td-elapsed" ).text( node.data.elapsed );
            $( node.tr ).find( ".td-backlog" ).text( node.data.backlog );

            // progress column
            htmlProgress = "<span class='td-progress'><div class='progress ui-progressbar ui-widget ui-widget-content ui-corner-all' ";
            htmlProgress += "role='progressbar' aria-valuemin='0' aria-valuemax='100' aria-valuenow='" + node.data.progress + "'>";
            htmlProgress += "<div class='ui-progressbar-value ui-widget-header ui-corner-left' style='width: " + node.data.progress + "%;'>";
            htmlProgress += "<div>" + node.data.progress + "%</div></div></div></span>";
            $( node.tr ).find( ".td-progress" ).html(htmlProgress);

         }
      });
   }

	  window.onload = initTree;
</script>


