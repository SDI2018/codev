function getIssuesAndDurations(h){h.preventDefault();h=jQuery("#projectid").val();var f=jQuery("#getIssuesAndDurationsForm");f.find("input[name=projectid]").val(h);var a=jQuery("#bugid");a.empty();a.select2("data",null);a.append(jQuery("<option>").attr("value","0").append(timetrackingSmartyData.i18n_pleaseWait).attr("selected","selected"));jQuery.ajax({url:timetrackingSmartyData.ajaxPage,type:f.attr("method"),dataType:"json",data:f.serialize(),success:function(d){a.empty();a.select2("data",null);
var e=d.availableIssues,b=0,c;for(c in e)e.hasOwnProperty(c)&&b++;1<b&&a.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected"));for(var g in e)e.hasOwnProperty(g)&&(b=e[g],b=null!=b.tcId&&""!=b.tcId?g+" / "+b.tcId+" : "+b.summary:g+" : "+b.summary,a.append(jQuery("<option>").attr("value",g).append(b)));e=jQuery("#job");e.empty();b=d.availableJobs;var f=0;for(c in b)b.hasOwnProperty(c)&&f++;1<f&&e.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected"));
for(g in b)b.hasOwnProperty(g)&&e.append(jQuery("<option>").attr("value",g).append(b[g]));jQuery("#duree").empty();d=d.availableDurations;for(g in d)d.hasOwnProperty(g)&&jQuery("#duree").append(jQuery("<option>").attr("value",g).append(d[g]))}})}
jQuery(document).ready(function(){function h(){f.find("input[name=projectid]").val(jQuery("#projectid").val());f.find("input[name=bugid]").val(jQuery("#bugid").val());f.find("input[name=job]").val(jQuery("#job").val());f.find("input[name=duree]").val(jQuery("#duree").val())}"en"!=timetrackingSmartyData.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[timetrackingSmartyData.datepickerLocale]);jQuery("#datepicker").datepicker("setDate",timetrackingSmartyData.datepickerDate);jQuery("#projectid").change(function(a){getIssuesAndDurations(a)});
jQuery("#filters").click(function(a){a.preventDefault();jQuery("#setfilter_dialog_form").dialog("open")});jQuery("#bugid").change(function(){if("0"===jQuery("#projectid").val()){var a=jQuery("#form1");a.find("input[name=action]").val("setBugId");a.find("input[name=weekid]").val(jQuery("#weekid").val());a.find("input[name=year]").val(jQuery("#year").val());a.submit()}});jQuery("#btAddTrack").click(function(){var a=0,d=timetrackingSmartyData.i18n_someFieldsAreMissing+"\n\n",e=jQuery("#form1"),b=e.find("select[name=bugid]").val(),
c=e.find("select[name=job]").val(),g=e.find("select[name=duree]").val();if("0"===b||""===b)d+=timetrackingSmartyData.i18n_task+"\n",++a;if("0"===c||""===c)d+=timetrackingSmartyData.i18n_job+"\n",++a;if("0"===g||""===g)d+=timetrackingSmartyData.i18n_duration+"\n",++a;0===a?(a=jQuery("#datepicker").val(),getUpdateBacklogData(b,timetrackingSmartyData.userid,c,g,a).done(function(a){"BacklogUpdateNotNeeded"===a.diagnostic?(e.find("input[name=action]").val("addTrack"),e.submit()):(jQuery("#formUpdateBacklog").off("submit"),
openUpdateBacklogDialogbox(a))})):alert(d)});jQuery("#setfilter_dialog_form").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var a=jQuery("#formSetFilters");a.find("input[name=projectid]").val(jQuery("#projectid").val());a.find("input[name=bugid]").val(jQuery("#bugid").val());a.find("input[name=job]").val(jQuery("#job").val());a.find("input[name=duree]").val(jQuery("#duree").val());a.find("input[name=weekid]").val(jQuery("#weekid").val());a.find("input[name=year]").val(jQuery("#year").val());
a.submit()},Cancel:function(){jQuery(this).dialog("close")}}});var f=jQuery("#formUpdateWeek");jQuery("#form1");jQuery("#formUpdateBacklog");jQuery("#previousweek").click(function(){h();var a=jQuery("#weekid").val();if(1!=a)f.find("select[name=weekid]").val(--a);else{a=+jQuery("#year").val()-1;var d=timetrackingSmartyData.nbWeeksPrevYear;f.find("select[name=weekid]").val(d);f.find("select[name=year]").val(a)}f.submit()});jQuery("#nextweek").click(function(){h();var a=jQuery("#weekid").val();parseInt(a)<
parseInt(timetrackingSmartyData.nbWeeksThisYear)?f.find("select[name=weekid]").val(++a):(a=+jQuery("#year").val()+1,f.find("select[name=weekid]").val(1),f.find("select[name=year]").val(a));f.submit()});jQuery("#weekid, #year").change(function(){h();f.submit()});jQuery(".deleteWeekTimetrack_link").click(function(a){a.preventDefault();var d=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getDeleteTimetrackData",
timetrackId:d},dataType:"json",success:function(a){"SUCCESS"===a.statusMsg&&(jQuery(".issue_summary").text(a.issueSummary),jQuery("#desc_date").text(a.date),jQuery("#desc_id").text(a.formatedId),jQuery("#desc_duration").text(a.duration),jQuery("#desc_job").text(a.jobName),jQuery("#formDeleteTrack").find("input[name=trackid]").val(d),jQuery("#backlogChangeInfo").text(""),a.isRecreditBacklog&&jQuery("#backlogChangeInfo").text("(Backlog will change to : "+a.futureBacklog+")"))},error:function(a,b,c){console.error(b,
c);alert("ERROR: Please contact your CodevTT administrator")}});jQuery("#deleteTrack_dialog_form").dialog("open")});jQuery("#deleteTrack_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:{Delete:function(){jQuery("#formDeleteTrack").submit()},Cancel:function(){jQuery(this).dialog("close")}}});jQuery(".editWeekTimetrack_link").click(function(a){a.preventDefault();var d=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,
data:{action:"getEditTimetrackData",timetrackId:d},dataType:"json",success:function(a){if("SUCCESS"===a.statusMsg){$("#timeToEdit").empty();var b=a.durationsList;for(c in b)b.hasOwnProperty(c)&&$("#timeToEdit").append($("<option>").attr("value",c).append(b[c]));$("#editJob").empty();b=a.availableJobs;for(c in b)b.hasOwnProperty(c)&&$("#editJob").append($("<option>").attr("value",c).append(b[c]));$("#timetrackId").val(d);$("#timeToEdit").val(a.duration);$("#backlogToEdit").val(a.backlog);$("#editJob").val(a.jobid);
$("#issue_note_edit").val(a.note);$("#taskSummary").text(a.issueSummary);$("#datepickerEditer").datepicker("setDate",a.date);var c=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+d+"]");c.attr("data-weekTimetrackBacklog",a.backlog);c.attr("data-weekTimetrackDuration",a.duration);c.attr("data-weekTimetrackIsRecreditBacklog",a.isRecreditBacklog);a=$("#editWeekTimetrack_dialog");a.find("#backlogChangeInfo").text("");a.dialog("open")}else console.error("Ajax statusMsg",a.statusMsg),
alert(a.statusMsg)},error:function(a,b,c){console.error(b,c);alert("ERROR: Please contact your CodevTT administrator")}})});$("#timeToEdit").change(function(){var a=$("#editWeekTimetrack_dialog"),d=a.find("#backlogChangeInfo"),e=a.find("#timetrackId").val();a=parseFloat(a.find("#timeToEdit").val());e=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+e+"]");var b=parseFloat(e.attr("data-weekTimetrackDuration")),c=parseFloat(e.attr("data-weekTimetrackBacklog"));"true"===e.attr("data-weekTimetrackIsRecreditBacklog")&&
(a!==b?d.text("(Backlog will change to : "+(c+b-a)+")"):d.text(""))});$("#editWeekTimetrack_dialog").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var a=$("#issue_note_edit").val(),d=$("#datepickerEditer").val(),e=$("#timeToEdit").val(),b=$("#editJob").val(),c=$("#timetrackId").val();$("#backlogToEdit").val();$.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"updateTimetrack",timetrackId:c,note:a,date:d,duration:e,jobid:b,userid:timetrackingSmartyData.userid,
weekid:timetrackingSmartyData.weekid,year:timetrackingSmartyData.year},success:function(a){if("SUCCESS"===a.statusMsg){var b=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+c+"]");b.find(".weekTimetrack_duration").text(e);b.find(".weekTimetrack_date").text(a.cosmeticDate);b.find(".weekTimetrack_jobName").text(a.jobName);b.find(".weekTimetrack_ttNote").html(a.ttNote);jQuery("#weekTaskDetailsDiv").html(jQuery.trim(a.timesheetHtml));updateWidgets("#weekTaskDetailsDiv")}else console.error("Ajax statusMsg",
a.statusMsg),alert(a.statusMsg)},error:function(a,b,c){console.error(b,c);alert("ERROR: Please contact your CodevTT administrator")}});jQuery(this).dialog("close")},Cancel:function(){jQuery(this).dialog("close")}}})});