jQuery(document).ready(function(){"en"!==smartyDataCmdEdit.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[smartyDataCmdEdit.datepickerLocale]);""!==smartyDataCmdEdit.cmdStartDate?jQuery("#cmdStartDate").datepicker("setDate",smartyDataCmdEdit.cmdStartDate):jQuery("#cmdStartDate").datepicker();""!==smartyDataCmdEdit.cmdDeadline?jQuery("#cmdDeadline").datepicker("setDate",smartyDataCmdEdit.cmdDeadline):jQuery("#cmdDeadline").datepicker();jQuery("#cmdStartDate").datepicker("option",
"beforeShow",function(a){jQuery(this).datepicker("option","maxDate",jQuery("#cmdDeadline").datepicker("getDate"))});jQuery("#cmdDeadline").datepicker("option","beforeShow",function(a){jQuery(this).datepicker("option","minDate",jQuery("#cmdStartDate").datepicker("getDate"))});jQuery("#btSaveCommand").click(function(){var a=0,b="",c=jQuery("#updateCmdInfoForm");0==c.find("input[name=cmdName]").val().length&&(b+=smartyDataCmdEdit.i18n_missingFieldCmdName+"\n",++a);""!=c.find("input[name=cmdTotalSoldDays]").val()&&
(bValid=checkRegexp(c.find("input[name=cmdTotalSoldDays]"),/^[0-9]+(\.[0-9]+)?$/i,"format: '1234' or '123.35'"),bValid||(b+=smartyDataCmdEdit.i18n_nanSoldCharge+"\n",++a));0===a?""!==smartyDataCmdEdit.cmdId?(a=saveTree(),a.done(function(){c.submit()}),a.fail(function(){$("#tree").fancytree("destroy");initTree()})):c.submit():alert(b)});""!==smartyDataCmdEdit.cmdId&&jQuery("#btDeleteCommand").click(function(a){jQuery("#deleteCommand_dialog_form").dialog("open")});jQuery("#btAddCmdIssue").click(function(a){addCmdIssue()});
jQuery("#bugid").keypress(function(a){jQuery.ui.keyCode.ENTER==a.keyCode&&(addCmdIssue(),a.preventDefault())});jQuery.ajax({url:"js_min/datatable.min.js",dataType:"script",cache:!0});jQuery("#deleteCommand_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:[{text:smartyDataCmdEdit.i18n_delete,click:function(){jQuery("#formDeleteCommand").submit()}},{text:smartyDataCmdEdit.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]});jQuery("#removeCmdIssue_dialog_form").dialog({autoOpen:!1,
resizable:!0,width:"auto",modal:!0,buttons:[{text:smartyDataCmdEdit.i18n_remove,click:function(){jQuery("#formRemoveCmdIssue").submit()}},{text:smartyDataCmdEdit.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]});jQuery("#removeCmdSet_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:[{text:smartyDataCmdEdit.i18n_remove,click:function(){jQuery("#formRemoveCmdSet").submit()}},{text:smartyDataCmdEdit.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]});
jQuery("#provisionsTable").on("click",".deleteProvision_link",function(a){a.preventDefault();var b=$(this).parents(".provRow");a=$(b).attr("data-provRowId");var c=$(b).children(".provDate").text(),d=$(b).children(".provType").text(),e=$(b).children(".provBudgetDays").text(),h=$(b).find(".provBudget").text(),f=$(b).find(".provCurrency").text();b=$(b).children(".provSummary").text();confirm(smartyDataCmdEdit.i18n_confirmDeleteProvision+"\n\n"+c+" "+d+"\n"+e+" "+smartyDataCmdEdit.i18n_days+"\n"+h+" "+
f+"\n\n"+b)&&$.ajax({url:smartyDataCmdEdit.ajaxPage,type:"POST",dataType:"json",data:{action:"deleteProvision",cmdId:smartyDataCmdEdit.cmdId,provRowId:a},success:function(a){null===a?(console.error("ERROR deleteProvision: no data"),alert("ERROR: Please contact your CodevTT administrator")):"SUCCESS"!==a.statusMsg?(console.error("ERROR Ajax statusMsg",a.statusMsg),alert(a.statusMsg)):jQuery(".provRow[data-provRowId='"+a.rowId+"']").remove()},error:function(a,b,c){console.error("ERROR deleteProvision errorThrown",
c)}})});jQuery("#provisionsTable").on("click",".editProvision_link",function(a){var b=$(this).parents(".provRow");a=$(b).attr("data-provRowId");var c=$(b).children(".provDate").text(),d=$(b).children(".provType").attr("data-provTypeId"),e=$(b).children(".provBudgetDays").text(),h=$(b).find(".provBudget").text(),f=$(b).find(".provCurrency").text(),k=$(b).children(".provSummary").text();b=$(b).find(".cbIsInCheckBudget").is(":checked");jQuery("#type").val(d);jQuery("#datepicker").val(c);jQuery("#budgetDays").val(e);
jQuery("#budget").val(h);jQuery("#provisionCurrency").val(f);jQuery("#provisionCurrencyDisplayed").html(f);jQuery("#summary").val(k);jQuery("#cb_isInCheckBudget").prop("checked",b);jQuery("#addProvRowId").val(a);jQuery("#averageDailyRate").val("");updateADR();a=jQuery("#addProvision_dialog_form");a.dialog("option","title",smartyDataCmdEdit.i18n_editProvision);jQuery("#addProvDlgAction").val("editProvision");a.dialog("open")});jQuery("#btAddProvision").click(function(a){a=jQuery("#addProvision_dialog_form");
a.dialog("option","title",smartyDataCmdEdit.i18n_addProvision);jQuery("#addProvDlgAction").val("addProvision");jQuery("#addProvRowId").val(0);jQuery("#datepicker").val("");jQuery("#budgetDays").val("");jQuery("#budget").val("");jQuery("#summary").val("");jQuery("#averageDailyRate").val("");jQuery("#cb_isInCheckBudget").prop("checked",!1);a.dialog("open")});jQuery("#addProvision_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:[{text:"OK",click:function(){var a=jQuery("#cb_isInCheckBudget").attr("checked")?
1:0,b=jQuery("#formAddProvision");b.find("input[name=isInCheckBudget]").val(a);jQuery.ajax({url:smartyDataCmdEdit.ajaxPage,type:"POST",dataType:"json",async:!1,data:b.serialize(),success:function(a){if("SUCCESS"===a.statusMsg)if(prov=a.provData,"editProvision"===a.action){var b=$(".provRow[data-provRowId="+prov.provId+"]");b.find(".provDate").text(prov.date);b.find(".provType").text(prov.type).attr("data-provTypeId",a.type_id);b.find(".provBudgetDays").text(prov.budget_days);b.find(".provBudget").text(prov.budget);
b.find(".provCurrency").text(prov.currency);b.find(".provSummary").html(prov.summary);b.find(".cbIsInCheckBudget").prop("checked",prov.is_checked);b.css("background-color","#ccffcc")}else a=createProvisionTr(prov),a.css("background-color","#ffff99"),a.prependTo("#provisionsTable tbody");else console.error("Ajax statusMsg",a.statusMsg),alert(a.statusMsg)},error:function(a,b,c){"Forbidden"===c?window.location=smartyDataCmdEdit.page:(console.error(b,c),alert("ERROR: Please contact your CodevTT administrator"))}});
jQuery(this).dialog("close")}},{text:smartyDataCmdEdit.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]});var c;jQuery("#fileInput").on("change",function(a){c=a.target.files[0]});jQuery("#btImportProvision").click(function(a){a=new FormData;a.append("uploaded_csv",c);a.append("action","importProvisionCSV");a.append("cmdid",smartyDataCmdEdit.cmdId);jQuery.ajax({async:!1,type:"POST",url:smartyDataCmdEdit.ajaxPage,data:a,processData:!1,contentType:!1,dataType:"json",success:function(a){"SUCCESS"===
a.statusMsg?(provData=a.provData,jQuery.each(provData,function(a,b){var c=createProvisionTr(b);c.css("background-color","#ffff99");c.prependTo("#provisionsTable tbody")})):(console.error("Ajax statusMsg",a.statusMsg),alert(a.statusMsg))},error:function(a,c,d){"Forbidden"===d?window.location=smartyDataCmdEdit.page:(console.error(c,d),alert("ERROR: Please contact your CodevTT administrator"))}})});jQuery("#provisionCurrency").on("change",function(a){a=jQuery("#provisionCurrency").val();jQuery("#provisionCurrencyDisplayed").html(a)});
jQuery("#budgetDays").keyup(function(a){updateBudget()});jQuery("#averageDailyRate").keyup(function(a){updateBudget()});jQuery("#budget").keyup(function(a){updateADR()});jQuery("#type").change(function(){var a=jQuery("#type").val()==smartyDataCmdEdit.cmdProvisionTypeMngt?!1:!0;jQuery("#cb_isInCheckBudget").prop("checked",a)})});function checkRegexp(c,a,b){return a.test(c.val())?!0:!1}
function addCmdIssue(){var c=0,a="",b=jQuery.trim(document.forms.addCmdIssueForm.bugid.value);""!=b?/^[0-9]+$/i.test(b)||(a+=smartyDataCmdEdit.i18n_nanTaskId+"\n",++c):(a+=smartyDataCmdEdit.i18n_missingFieldTaskId+"\n",++c);0==c?document.forms.addCmdIssueForm.submit():alert(a)}
function removeCmdIssue(c,a,b){jQuery("#desc_id").text(c);jQuery("#desc_project").text(a);jQuery("#desc_summary").text(b);jQuery("#formRemoveCmdIssue").find("input[name=bugid]").val(c);jQuery("#removeCmdIssue_dialog_form").dialog("open")}function removeCmdSet(c,a){var b=jQuery("#removeCmdSet_dialog_form");b.find(".desc_id").text(c);b.find(".desc_name").text(a);b.find("#formRemoveCmdSet").find("input[name=commandsetid]").val(c);b.dialog("open")}var provData;
function updateADR(){if(""!=jQuery("#budget").val()&&0!=jQuery("#budget").val()&&""!=jQuery("#budgetDays").val()&&0!=jQuery("#budgetDays").val()){var c=parseFloat(jQuery("#budget").val())/parseFloat(jQuery("#budgetDays").val());jQuery("#averageDailyRate").val(c.toFixed(2))}}
function updateBudget(){if(""!=jQuery("#averageDailyRate").val()&&0!=jQuery("#averageDailyRate").val()&&""!=jQuery("#budgetDays").val()&&0!=jQuery("#budgetDays").val()){var c=parseFloat(jQuery("#budgetDays").val())*parseFloat(jQuery("#averageDailyRate").val());jQuery("#budget").val(c.toFixed(2))}}
function createProvisionTr(c){var a=jQuery("<tr></tr>").addClass("provRow").attr("data-provRowId",c.provId),b=jQuery('<img align="absmiddle" src="images/b_drop.png">').addClass("deleteProvision_link").addClass("pointer").prop("title",smartyDataCmdEdit.i18n_delete),g=jQuery('<img align="absmiddle" src="images/b_edit.png">').addClass("editProvision_link").addClass("pointer").prop("title",smartyDataCmdEdit.i18n_edit),d=jQuery('<td style="width:38px;">').addClass("ui-state-error-text");d.append(b).append(" ").append(g);
b=jQuery("<span>").text(c.budget).addClass("provBudget");g=jQuery("<span>").text(c.currency).addClass("provCurrency");var e=jQuery('<td style="text-align: right;">');e.append(b).append(" ").append(g);a.append(d);a.append(jQuery("<td>").text(c.date).addClass("provDate"));a.append(jQuery("<td>").text(c.type).addClass("provType"));a.append(jQuery("<td>").text(c.budget_days).addClass("provBudgetDays"));a.append(e);a.append(jQuery("<td>").html(c.summary).addClass("provSummary"));c.is_checked?a.append(jQuery("<td>").html('<input type="checkbox" class="cbIsInCheckBudget" disabled="disabled" checked/>')):
a.append(jQuery("<td>").html('<input type="checkbox" class="cbIsInCheckBudget" disabled="disabled" />'));c.csvFileLine&&a.attr("data-csvFileLine",c.csvFileLine);return a};